---
title: "temp1_pj3"
author: "Yang Lyu"
date: "06/11/2023"
output: pdf_document
---

```{r}
library(dplyr)
library(lubridate)
```

```{r}
BASA <- read.csv("BASA_AUC_2028_912.csv", header = TRUE)
dat_F <- read.csv("dat_F_sub.csv", header = TRUE)
dat_P <- read.csv("dat_P_sub_c.csv", header = TRUE)
years <- read.csv("years20262030.csv", header = TRUE)
```

```{r}
BASA$Period_of_Week[BASA$Period_of_Week == "1 - WEEKDAY"] <- "temp"
BASA$Period_of_Week[BASA$Period_of_Week == "2 - WEEKEND"] <- "1 - WEEKDAY"
BASA$Period_of_Week[BASA$Period_of_Week == "temp"] <- "2 - WEEKEND"

BASA_WEEKDAY <- BASA %>% filter(Period_of_Week == "1 - WEEKDAY" & Day_of_Week %in% c("	
1 - MON","2 - TUE","	
3 - WED","4 - THU","	
5 - FRI"))

BASA_WEEKEND <- BASA %>% filter(Period_of_Week == "2 - WEEKEND" & Day_of_Week %in% c("6 - SAT","7 - SUN"))

BASA_WEEKDAY_SUMMER <- BASA_WEEKDAY %>% filter(Season == "3 - SUMMER")
BASA_WEEKDAY_AUTUMN <- BASA_WEEKDAY %>% filter(Season == "4 - AUTUMN")
BASA_WEEKEND_SUMMER <- BASA_WEEKEND %>% filter(Season == "3 - SUMMER")
BASA_WEEKEND_AUTUMN <- BASA_WEEKEND %>% filter(Season == "4 - AUTUMN")
```

```{r}
FilterByTimeS2 <- function(df, start_time, end_time, interval_minutes) {
  df$S2 <- as.POSIXct(df$S2)
  df$Time <- format(df$S2, "%H:%M:%S")
  result <- list()

  for (start in seq(0, 24 * 60, by = interval_minutes)) {
    end <- start + interval_minutes
    interval_start_time <- sprintf("%02d:%02d:%02d", start %/% 60, start %% 60, 0)
    interval_end_time <- sprintf("%02d:%02d:%02d", end %/% 60, end %% 60, 0)

    # Filter rows within the current time interval
    filtered_df <- df[df$Time >= interval_start_time & df$Time < interval_end_time, ]

    # Add the filtered data frame to the list
    result[[paste(interval_start_time, interval_end_time, sep = "_")]] <- filtered_df
  }

  return(result)
}
```

```{r}
# fill missing wait time with mean
fill_missing <- function(df){
  mean_value <- round(mean(df$Wait_Time, na.rm = TRUE),0)
  df$Wait_Time[is.na(df$Wait_Time)] <- mean_value
  return(df)
}
```

```{r}
List1 <- list(BASA_WEEKDAY_SUMMER,BASA_WEEKDAY_AUTUMN,BASA_WEEKEND_SUMMER,BASA_WEEKEND_AUTUMN)
```

```{r}
time_interval <- c("00:00:00_04:00:00","04:00:00_08:00:00","08:00:00_12:00:00","12:00:00_16:00:00","16:00:00_20:00:00","20:00:00_24:00:00")
BASA_fill <- data.frame()

for(i in c(1,2,3,4)){
  filter_df <- FilterByTimeS2(List1[[i]], start_time = "00:00:00", end_time = "24:00:00", 240)
  for(j in time_interval){
    filter_fill <- fill_missing(filter_df[[j]])
    BASA_fill <- rbind(BASA_fill,filter_fill)
  }
}
```

```{r}
# Ccalculate S1 = S2-Wait_Time
BASA_fill$S2 <- as.POSIXct(BASA_fill$S2, format = "%Y-%m-%d %H:%M:%S")
BASA_fill$S1 <- BASA_fill$S2 - as.numeric(BASA_fill$Wait_Time) * 60 
sum(is.na(BASA$S1))
sum(is.na(BASA$S2))
```

```{r}
FilterByTimeS1 <- function(df, start_time, end_time, interval_minutes) {
  df$S1 <- as.POSIXct(df$S1)
  df$Time <- format(df$S1, "%H:%M:%S")
  result <- list()

  for (start in seq(0, 24 * 60, by = interval_minutes)) {
    end <- start + interval_minutes
    interval_start_time <- sprintf("%02d:%02d:%02d", start %/% 60, start %% 60, 0)
    interval_end_time <- sprintf("%02d:%02d:%02d", end %/% 60, end %% 60, 0)

    # Filter rows within the current time interval
    filtered_df <- df[df$Time >= interval_start_time & df$Time < interval_end_time, ]

    # Add the filtered data frame to the list
    result[[paste(interval_start_time, interval_end_time, sep = "_")]] <- filtered_df
  }

  return(result)
}
```

```{r}
BASA_WEEKDAY <- BASA_fill %>% filter(Period_of_Week == "1 - WEEKDAY" & Day_of_Week %in% c("	
1 - MON","2 - TUE","	
3 - WED","4 - THU","	
5 - FRI"))

BASA_WEEKEND <- BASA_fill %>% filter(Period_of_Week == "2 - WEEKEND" & Day_of_Week %in% c("6 - SAT","7 - SUN"))
```

```{r}
BASA_WEEKDAY_SUMMER <- BASA_WEEKDAY %>% filter(Season == "3 - SUMMER")
BASA_WEEKDAY_AUTUMN <- BASA_WEEKDAY %>% filter(Season == "4 - AUTUMN")
BASA_WEEKEND_SUMMER <- BASA_WEEKEND %>% filter(Season == "3 - SUMMER")
BASA_WEEKEND_AUTUMN <- BASA_WEEKEND %>% filter(Season == "4 - AUTUMN")
```

```{r}
List2 <- list(BASA_WEEKDAY_SUMMER,BASA_WEEKDAY_AUTUMN,BASA_WEEKEND_SUMMER,BASA_WEEKEND_AUTUMN)
```

```{r}
lambda <- data.frame()
for(i in c(1,2,3,4)){
  filter_df <- FilterByTimeS1(List2[[i]], start_time = "00:00:00", end_time = "24:00:00", 240)
  for(j in time_interval){
    if(i == 1){
      cluster <- filter_df[[j]]
      lambda <- rbind(lambda,c("Summer","Weekday",j,nrow(cluster)/(13*5*4)))
    }
    else if(i == 2){
      cluster <- filter_df[[j]]
      lambda <- rbind(lambda,c("Autumn","Weekday",j,nrow(cluster)/(13*5*4)))
    }
    else if(i == 3){
      cluster <- filter_df[[j]]
      lambda <- rbind(lambda,c("Summer","Weekend",j,nrow(cluster)/(13*2*4)))
    }
    else{
      cluster <- filter_df[[j]]
      lambda <- rbind(lambda,c("Autumn","Weekend",j,nrow(cluster)/(13*2*4)))
    }
  }
}
colnames(lambda) <- c("Season","Period_of_week","Time_Period","Arrival_rate")
View(lambda)
```