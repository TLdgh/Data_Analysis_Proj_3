---
title: |
  | \vspace{-4em}MAT5314 Project 3: Queueing Theory
author: 
  - Teng Li(7373086)
  - Shiya Gao(300381032) 
  - Chuhan Yue(300376046)
  - Yang Lyu(8701121)
output: 
  pdf_document: 
    keep_tex: true
    includes:
      in_header: columns.tex
fontsize: 12pt
header-includes: 
  - \renewcommand{\and}{\\}
  - \usepackage{float}
  - \floatplacement{figure}{H}
bibliography: References.bib
link-citations: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(plotly)
library(tidyverse)
library(kableExtra)
library(htmlwidgets)
library(webshot)
```

### Introduction

It is common that a passenger gets screened at an airfield for security and management purpose. This screening process involves some major steps such as scanning the boarding pass at entrance, serving the passenger, and exiting the service desk. This process can be described by queuing theory, in which a statistical model is built to analyze the waiting time and service processes. It allows to examine the relationship between inter-arrivals, service times and the capacity of the system demonstrated by calculating the number of servers needed to achieve certain quality of service level. In the end, one can gain an overall picture of the efficiency and dynamics of the screening process.

We were given four data sets containing the details of the screening process at the four major airfields of the nation. Our goal was to explain the data sets through data definitions and explanations, to explore the data sets by visualizing and analyzing their variables and possible relationships, and finally to perform the queuing analysis to predict the expected wait time at each airfield.

### Data Definition

```{r}
BASA<-read.csv("BASA_AUC_2028_912.csv", header = TRUE)
Flight<-read.csv("dat_F_sub.csv")
Passenger<-read.csv("dat_P_sub_c.csv")
Y2026<-read.csv("years20262030.csv")
```

The four data sets had common variables. The BASA data set was the biggest one containing most of the common variables, hence we used it as the main data set. We compared the variables between BASA and Passenger data and noticed that Passenger had unique variables with suffix "Flag", which we thought was not useful for our analysis. Other unique variables in Passenger were presented in other tables as well, hence these variables were omitted in our Queuing Analysis section. 
```{r}
setdiff(colnames(Passenger), colnames(BASA))
```

Similarly, the Flight data had variables that weren't really relevant or useful for our analysis, hence we also omitted them in Queuing Analysis.
```{r}
setdiff(colnames(Flight), colnames(BASA))
```

BASA and Y2026 had the same variables, except that Y2026 has airfields other than Auckland.

We gave a proper data definition in the following Table() for BASA data and for the unique variables in Passenger and Flight data in Table () and Table(). 

```{r}
DataDict<-BASA%>%select(-X)
DataDict<-data.frame(
  Variables=colnames(DataDict),
  Example=sapply(DataDict, function(x) paste(as.character(head(unique(x),1)), collapse = ", ")),
  Number.Unique=sapply(DataDict, function(x) length(unique(x))),
  PctMissing=sapply(DataDict, function(x) paste0(round(sum(is.na(x))/length(x), 4)*100,"%" ) ),
  Comment=c("Airfield from which the passenger departed: Auckland [AUC], Chebucto [CWL], Queenston [QUE], SaintFrancois [SAF]",
            "the date and time at which passengers exited the main queue S2, recorded to the nearest minute",
            "The waiting time of passenger in queue from S1 to S2, rounded up to the minute",
            "The number of security agents at S1 when passenger was scaned",
            "The number of security agents at S2 when passenger was scaned",
            "The average number of security agents at S1 and S2",
            "scheduled departure time",
            "actual departure time" ,
            "city of destination",
            "country of destination",
            "order",
            "ID for each passenger exited the main queue",
            "Departure_Date",
            "Departure_Time (recored in seconds: h*3600+m*60+s)",
            "departure time of day",
            "departure day is weekend or weeakday",
            "departure day in a week",
            "month of departure",
            "season of departure",
            "year of departure"
            ), row.names = NULL
)

DataDict%>%kable(booktabs = TRUE,caption = "BASA Variable Definition")%>%
  kable_styling(font_size=7, latex_options=c("striped","hold_position"))%>%
  column_spec(2, width = "8em")%>%
  column_spec(5, width = "15em")%>%
  row_spec(0,bold=TRUE)
```

```{r}
DataDict<-Passenger%>%select(setdiff(colnames(Passenger), colnames(BASA)))
DataDict<-data.frame(
  Variables=colnames(DataDict),
  Example=sapply(DataDict, function(x) paste(as.character(head(unique(x),2)), collapse = ", ")),
  Number.Unique=sapply(DataDict, function(x) length(unique(x))),
  PctMissing=sapply(DataDict, function(x) paste0(round(sum(is.na(x))/length(x), 4)*100,"%" ) ), 
  Comment=c("Valid passenger ID",
            "If Wait_Time is NA or not",
            "If S2 Schedule departure is NA or not",
            "If S2 Actural departure is NA or not",
            "If Schedule departure is NA or not",
            "Flight ID",
            "Delay in seconds"
            ),
  row.names = NULL
)

DataDict%>%kable(booktabs = TRUE,caption = "Passenger Variable Definition")%>%
  kable_styling(font_size=10, latex_options=c("striped","scale_down","hold_position"))%>%
  column_spec(2, width = "8em")%>%
  row_spec(0,bold=TRUE)
```

```{r}
DataDict<-Flight%>%select(setdiff(colnames(Flight), colnames(BASA)))
DataDict<-data.frame(
  Variables=colnames(DataDict),
  Example=sapply(DataDict, function(x) paste(as.character(head(unique(x),2)), collapse = ", ")),
  Number.Unique=sapply(DataDict, function(x) length(unique(x))),
  PctMissing=sapply(DataDict, function(x) paste0(round(sum(is.na(x))/length(x), 4)*100,"%" ) ),
  Comment=c("Flight ID",
            "total number of passengers",
            "actual number of passengers",
            "mimimum waiting time",
            "mean waiting time",
            "median waiting time",
            "maximum waiting time",
            "mean length of waiting time",
            "mean_City_Flag",
            "mode_BFO_Dest_City",
            "sum of the mode in the city",
            "number of destinated city",
            "mode_BFO_Dest_Country_Code",
            "sum of the mode in the country",
            "number of destinated country",
            "delay second"
            ), row.names = NULL
)

DataDict%>%kable(booktabs = TRUE,caption = "Flight Variable Definition")%>%
  kable_styling(font_size=10, latex_options=c("striped","scale_down","hold_position"))%>%
  column_spec(2, width = "8em")%>%
  row_spec(0,bold=TRUE)
```

We must also pointed out that there were flaws in these data sets that we had to correct. The BASA data contained the useful information from the Passenger data, as we have explained earlier. However there was a discrepancy of 10 minutes between the BASA Schedule Departure time and the Passenger Schedule Departure time. We believed that this difference is a minor mistake. BASA data contained the least amount of mistakes overall, hence another reason for us to use the BASA data directly in our Queuing analysis. In addition, The Period_of_Week variable did not match with the Day_of_Week, therefore we have cleaned all these flaws before doing the subsequent analyses.

```{r}
#clean BASA data:
BASA<-BASA%>%mutate(Period_of_Week=case_when(
    Day_of_Week=="6 - SAT" | Day_of_Week=="7 - SUN" ~ "2 - WEEKEND",
    .default = "1 - WEEKDAY"
), S2=as.POSIXct(S2))

#BASA[which(BASA$Time_of_Day=="1 - NIGHT"),"Time_of_Day"]<-"4 - EVENING"
```


### Data exploration

In the data Y2026, there were only two kinds of seasons: winter and autumn. Autumn contained only 7 data points and winter had 3219 points, which in total accounted for the bulk of the data. One can see from the Airfield column that although it contained the most types of airfields among the four data sets, except for SaintFrancois(SAF), the other three airfields had negligible proportions. The airfields in the data set BASA were all Auckland (AUC), whereas in Y2026 there were only four data points for which the airfield was AUC. Compared with BASA, Y2026 provided too little information. If we analyze the data of Y2026 based on the combination of categories of Time_of_ Day, Day_of_Week and Season respectively, the count of arrivals of Y2026 in most of clusters was almost zero, that is to say, the data of Y2026 was not very useful to the overall analysis, so we discard this data set.
```{r, results='asis'}
ftable(Y2026[, c("Airfield", "Season", "Time_of_Day", "Day_of_Week")])
```

From the data definition Table() one can see the Wait_Time variable had nearly 15% missing data, thus deleting it will affect the result drastically. We chose to fill in the missing data with the mean value of the wait time. First, we divided the data based on the categories of Season(3 - SUMMER,4 - AUTUMN), Period_of_Week(1 - WEEKDAY,2 - WEEKEND), and Time_of_Day(1 - NIGHT,2 - MORNING,3 - AFTERNOON,4 - EVENING) into 16 clusters. Then we computed the mean value of the wait time in each cluster and used these means to fill the missing wait time of the corresponding cluster.

```{r}
#make list of 16 clusters:
BASA_fill <- split(BASA, list(BASA$Season, BASA$Period_of_Week, BASA$Time_of_Day))

# fill missing wait time with mean
fill_missing <- function(df){
  mean_value <- round(mean(df$Wait_Time, na.rm = TRUE),0)
  df$Wait_Time[is.na(df$Wait_Time)] <- mean_value
  return(df)
}

BASA_fill<-map(BASA_fill, fill_missing)
```

However we found that there were still data points whose wait time were missing after the operation of filling the missing data. The reason was that the cluster had no data points, so there was no wait time data for calculating the mean value.
In addition, we found that there was also a missing data in column C0. Since there were only two points of data with missing values, we decided to omit these two rows directly.

```{r, echo=FALSE}
BASA<-do.call(rbind, BASA_fill)
BASA <- BASA %>% filter(!is.na(Wait_Time))
BASA <- BASA %>% filter(!is.na(C0))
```

According to the Figure() "Wait Time by Time_of_Day", we found that the number of passengers arrived in the morning, afternoon and evening were relatively average, but the number of passengers in the evening had a very obvious gap compared to other three periods, i.e., the number of arrivals at night was very small. This was expected because normally there is few flights between 0-6 o'clock or most of the people would not choose to fly in this time period. In addition, we found from Figure() that the wait time in a queue to go through the security check S2 for AFTERNOON and EVENING was mainly concentrated in 2-5 minutes, which was relatively shorter. When the wait time was greater than 5 MINUTES, the number of passengers in the queue for MORNING was significantly higher than that for other periods, and when the wait time was between 6-7 minutes, MORNING had the most passenger arrivals, totaling 8757. So we concluded that: MORNING had the longest waiting time, and the queuing period of AFTERNOON and EVENING were about the same, basically within 5 minutes.

```{r, echo=FALSE}
#Classification according to Time_of_Day(Morning;Afternoon;Evening;Night)
time_of_day_categories <- unique(BASA$Time_of_Day)

p0 <- plot_ly()
for (time_of_day in time_of_day_categories) {
  subset_data <- BASA[BASA$Time_of_Day == time_of_day, ]
  color <- switch(
    time_of_day,
    "2 - MORNING" = "lightblue",
    "3 - AFTERNOON" = "orange",
    "4 - EVENING" = "green",
    "1 - NIGHT" = "purple"
  )
  p0 <- add_trace(
    p0,
    type = "histogram",
    x = subset_data$Wait_Time,
    name = time_of_day,
    marker = list(color = color, line = list(color = "black")),
    xbins = list(size = 2)
  )
}

p0 <- layout(
  p0,
  title = "Wait Time by Time_of_Day",
  xaxis = list(title = "Wait Time(Minute)", range = c(0, 25)),
  yaxis = list(title = "Number of Passengers"),
  showlegend = TRUE
)

p0
```

In order to compare the wait times for each Time_of_Day more accurately, we calculated their respective averages. As previously observed: the wait time in the morning was the longest, with an average of about 7 minutes; and afternoon and evening had about the same wait time, with an average of approximately 4 minutes. Lastly, although there was very little data for the night, the average wait time for the night was the second longest, at around 6 minutes. Again one can expect this due to the lack of staff in the airport at night.

```{r, echo=FALSE}
# Average Wait_Time for each Time_of_Day
avg_time_day <- tapply(BASA$Wait_Time, BASA$Time_of_Day, mean)

avg_time_day_df <- data.frame(Time_of_Day = names(avg_time_day),
                               Average_Wait_Time = avg_time_day)

plot_ly(
  x = avg_time_day_df$Time_of_Day,
  y = avg_time_day_df$Average_Wait_Time,
  type = "bar",
  name = "Average Wait Time",
  marker = list(color = "lightblue", line = list(color = "black")),
              text = avg_time_day_df$Average_Wait_Time,
              textposition = "outside",
              textfont = list(size = 14)) %>%
  layout(
    title = "Average Wait Time by Time_of_Day",
    xaxis = list(title = "Time_of_Day"),
    yaxis = list(title = "Average Wait Time")
  )
```

Next, we compared and analyzed the wait time by Day_of_Week, and the result was shown in Figure() "Wait Time by Day_of_Week". On the whole, the longer the wait time was, the less the number of passengers was. In addition, we found that regardless of the day of the week, when the wait time was within the range of 2-5 minutes, the number of passengers was significantly more than other wait time's number of passengers, in which the queue on Saturday was the largest, with a total of 11,994 passengers, followed by Wednesday, with a total of 11,656 passengers. When the wait time was greater than or equal to 6 minutes, for any wait time, the number of people queuing up for S2 on Thursday was the largest; in contrast, the number of passengers queuing up for S2 on Monday was basically the smallest. Thus, we concluded that Thursday's wait time was the longest, while Monday's wait time was the shortest.

```{r, echo=FALSE}
#Classification by day of the week
day_of_week_categories <- unique(BASA$Day_of_Week)

p2 <- plot_ly()
for (day_of_week in day_of_week_categories) {
  subset_data <- BASA[BASA$Day_of_Week == day_of_week, ]
  
  color <- switch(
    day_of_week,
    "1 - MON" = "lightblue",
    "2 - TUE" = "orange",
    "3 - WED" = "green",
    "4 - THU" = "red",
    "5 - FRI" = "purple",
    "6 - SAT" = "brown",
    "7 - SUN" = "pink"
  )

  p2 <- add_trace(
    p2,
    type = "histogram",
    x = subset_data$Wait_Time,
    name = day_of_week,
    marker = list(color = color, line = list(color = "black")),
    xbins = list(size = 2)
  )
}

p2 <- layout(
  p2,
  title = "Wait Time by Day_of_Week",
  xaxis = list(title = "Wait Time(Minute)", range = c(0, 30)),
  yaxis = list(title = "Number of Passengers"),
  showlegend = TRUE
)

p2
```

Figure() "Average Wait Time by Day of Week" showed the average wait time for each day of the week. As we had mentioned earlier, Thursday's average wait time was the longest, at nearly 7 minutes; Monday's wait time was the shortest, at an average of 4.37 minutes. Tuesday, Saturday and Sunday had about equal wait times, around 5 minutes. And Wednesday and Friday had average wait times in the 5-6 minute range.

```{r, echo=FALSE}
#Average Wait_Time per Day_of_Week
avg_time <- tapply(BASA$Wait_Time, BASA$Day_of_Week, mean)

avg_time_df <- data.frame(Day_of_Week = names(avg_time),
                               Average_Wait_Time = avg_time)

plot_ly(x = avg_time_df$Day_of_Week,
              y = avg_time_df$Average_Wait_Time,
              type = "bar",
              name = "Average Wait Time",
              marker = list(color = "lightblue", line = list(color = "black")),
              text = avg_time_df$Average_Wait_Time,
              textposition = "outside",
              textfont = list(size = 14)) %>%
  layout(title = "Average Wait Time by Day of Week",
         xaxis = list(title = "Day of Week"),
         yaxis = list(title = "Average Wait Time"))
```

Finally, we compared the difference in wait time and number of passengers by Season. Since the data for Spring and Winter were too scarce, we ignored them and only compared Summer and Autumn's wait time. When the range of wait time changed from 0-1 minute to 1-2 minutes, there was a significant increase in the number of people in the queue: the number of people queuing up for S2 in the Summer grew from 1,714 to more than 10,162 people, and the number of passengers in the queue in the Autumn grew even more, from 4,232 to 27,792, which was the highest number of people in the summer and the autumn for different wait time ranges. When the wait time started at 2 minutes or more, the number of people waiting in line decreased in summer and autumn as the wait time got longer. However, regardless of the wait time range, the number of people waiting in line for S2 in the autumn was basically higher than the number of passengers in the summer.

```{r, echo=FALSE}
#Classification according to Season
season_categories <- unique(BASA$Season)

p3 <- plot_ly()
for (season in season_categories) {
  subset_data <- BASA[BASA$Season == season, ]
  
  color <- switch(
    season,
    "1 - WINTER" = "green",
    "2 - SPRING" = "red",
    "3 - SUMMER" = "lightblue",
    "4 - AUTUMN" = "orange",
  )

  p3 <- add_trace(
    p3,
    type = "histogram",
    x = subset_data$Wait_Time,
    name = season,
    marker = list(color = color, line = list(color = "black")),
    xbins = list(size = 2)
  )
}

p3 <- layout(
  p3,
  title = "Wait Time by Season",
  xaxis = list(title = "Wait Time(Minute)", range = c(0, 23)),  # Closing parenthesis added here
  yaxis = list(title = "Number of Passengers"),
  showlegend = TRUE
)

p3
```

From Figure() "Average Wait Time by Season", we could see that although there was a big difference between the number of people waiting in the airport security lines in the summer and the autumn, the average wait time of these two were almost the same, both were more than 5 minutes, and the difference was only about half a minute. This meant that season had a larger impact on the number of passengers in the airport, but a smaller impact on the waiting time in line.
```{r, echo=FALSE}
#Average Wait_Time for each Season
avg_time_season <- tapply(BASA$Wait_Time, BASA$Season, mean)

avg_time_season_df <- data.frame(Season = names(avg_time_season),
                               Average_Wait_Time = avg_time_season)

plot_ly(
  x = avg_time_season_df$Season,
  y = avg_time_season_df$Average_Wait_Time,
  type = "bar",
  name = "Average Wait Time",
  marker = list(color = "lightblue", line = list(color = "black")),
              text = avg_time_season_df$Average_Wait_Time,
              textposition = "outside",
              textfont = list(size = 14)) %>%
  layout(
    title = "Average Wait Time by Season",
    xaxis = list(title = "Season"),
    yaxis = list(title = "Average Wait Time")
  )
```

Next, we compared C0 (the number of servers at S2) under different Time_of_Day(NIGHT;MORNING;AFTERNOON;EVENING). Because of the small number of data, NIGHT could not be visualized in Figure() "The Number of Security Agents at S2 by Time_of_Day". Otherwise, we found that the ordering of the number of passengers queuing for S2 in the MORNING, AFTERNOON, and NIGHT was opposite when C0 was equal to 0-1 and when C0 was equal to 2-3. When C0 was 0-1, the number of passengers in the afternoon was the largest, up to 33704; followed by evening, 22592; morning had the lowest number of passengers among these three, 15881. However, when C0 ranged from 2 to 3, Morning had the largest number of people waiting in line for security check S2 of these three, totaling 21,762, followed by Evening with 12,350, and the smallest number of people in the afternoon with only 7,792. When C0 was increased from 0-1 to 2-3, the number of passengers in the queues at both evening and afternoon decreased substantially, above 10,000 people; however, the number of people at morning increased by 5,000 instead. Therefore, we found that in the morning, the airport increased the number of servers by 1-2 to help passengers reduce their waiting time.

```{r, echo=FALSE}
#Number of C0 (servers of S2) with different Time_of_Day
p4 <- plot_ly()
for (time_of_day in time_of_day_categories) {
  subset_data <- BASA[BASA$Time_of_Day == time_of_day, ]
  color <- switch(
    time_of_day,
    "2 - MORNING" = "lightblue",
    "3 - AFTERNOON" = "orange",
    "4 - EVENING" = "green",
    "1 - NIGHT" = "purple"
  )
  p4 <- add_trace(
    p4,
    type = "histogram",
    x = subset_data$C0,
    name = time_of_day,
    marker = list(color = color, line = list(color = "black")),
    xbins = list(size = 2)
  )
}

p4 <- layout(
  p4,
  title = "The Number of Security Agents at S2 by Time_of_Day",
  xaxis = list(title = "The Number of Security Agents"),
  yaxis = list(title = "Number of Passengers"),
  showlegend = TRUE
)

p4
```

From Figure() "Average Number of Security Agents at S2(C0) by Time_of_Day", we found that the average number of security agents at S2 in the morning was the highest, which equaled to about 1.60. Although the average number of C0 in the evening was the second highest, which was approximately 1.37, there was still a gap with the average number of servers in the morning. Finally, even if the number of servers at night was too small to be shown in Figure(), its average number of servers was actually about the same as the average number of servers in the afternoon, which was around 1.20. Overall, we found that the number of servers was rather uniformly distributed around 1.3, which supported our M/M/1 model assumption in the subsequent Queuing Analysis.
```{r, echo=FALSE}
# Average C0(The Number of Security Agents at S2) for each Time_of_Day
avg_time_day <- tapply(BASA$C0, BASA$Time_of_Day, mean)

avg_time_day_df <- data.frame(Time_of_Day = names(avg_time_day),
                               Average_C0 = avg_time_day)

plot_ly(
  x = avg_time_day_df$Time_of_Day,
  y = avg_time_day_df$Average_C0,
  type = "bar",
  name = "Average Number of Security Agents at S2(C0)",
  marker = list(color = "lightblue", line = list(color = "black")),
              text = avg_time_day_df$Average_C0,
              textposition = "outside",
              textfont = list(size = 14)) %>%
  layout(
    title = "Average Number of Security Agents at S2(C0) by Time_of_Day",
    xaxis = list(title = "Time_of_Day"),
    yaxis = list(title = "Average Number of Security Agents at S2(C0)")
  )
```

### Queuing Analysis

```{r}
MakeTbl<-function(cluster){
  if(is_empty(unique(cluster$Period_of_Week))==TRUE){
    Result <- data.frame(Season=NaN, Period_of_Week=NaN,Time_of_Day=NaN,Count=NaN,Minute=NaN,Arrival_Rate=NaN,Avg_Wait_Time=NaN,Service_Rate=NaN,Avg_Servers=NaN)
  }else{
    if(unique(cluster$Period_of_Week)=="1 - WEEKDAY"){Minute<-13*5*6*60}else{Minute<-13*2*6*60}
    #Minute<-difftime(max(cluster$S2),min(cluster$S2), units = "mins")%>%as.numeric()
    
    Count<-nrow(cluster) #number of arrivals
    lambda <-Count/Minute #lambda is the arrival rate (number of arrivals per unit time)
    Wq <- mean(cluster$Wait_Time) #Wq is the average wait time
    mu <- (Wq*lambda+sqrt((Wq*lambda)^2+4*Wq*lambda))/(2*Wq) #mu is the service rate per unit time
    c <- mean(cluster$C0,na.rm = TRUE)
    
    Result <- data.frame(Season=unique(cluster$Season),Period_of_Week=unique(cluster$Period_of_Week),
                         Time_of_Day=unique(cluster$Time_of_Day),Count,Minute=Minute,Arrival_Rate=lambda,
                         Avg_Wait_Time=Wq,Service_Rate=mu,Avg_Servers=c)
  }
  return(Result)
}
Result<-do.call(rbind, map(BASA_fill, MakeTbl))
```

```{r}
Result%>%select(-c(Season, Period_of_Week,Time_of_Day))%>%
  kable(booktabs = TRUE,caption = "Result")%>%
  kable_styling(font_size=7, latex_options=c("striped","scale_down", "hold_position"))%>%
  row_spec(0,bold=TRUE)
```

Regression Model
$\mu=\mu(\lambda,c)=ac+b\lambda$
$\frac{\mu}{c}=b\frac{\lambda}{c}+a$

```{r}
regression_data <-Result%>%transmute(Avg_Servers, Arrival_Rate,Service_Rate,
                                    arrival_rate_perserver=Arrival_Rate/Avg_Servers,
                                    service_rate_perserver=Service_Rate/Avg_Servers)

# Regression model
regression_model<- lm(service_rate_perserver ~ arrival_rate_perserver,data = regression_data[-c(1,9,13),])
summary(regression_model)
```

```{r}
regression_data%>%
  kable(booktabs = TRUE,caption = "Regression Data")%>%
  kable_styling(font_size=7, latex_options=c("striped","scale_down", "hold_position"))%>%
  row_spec(0,bold=TRUE)
```

$service\_rate\_perserver=1.43244*arrival\_rate\_perserver+0.03544 $
$\frac{\mu}{c}=1.43244 \frac{\lambda}{c}+0.03544$
$\mu=1.43244\lambda+0.03544c$
implies that $\hat{a}=0.03544$ and $\hat{b}=1.43244$, where $\lambda$ is the arrival rate, $c$ is the average number of servers, $\mu$ is the service rate.

```{r}
plot(regression_data[-c(3,4),]$arrival_rate_perserver, regression_data[-c(3,4),]$service_rate_perserver, pch = 16, col = "blue", xlab = "Arrival rate per server", ylab = "Service rate per server", main = "Regression Line and Points")

abline(regression_model, col = "red")

legend("topleft", legend = c("Points", "Regression Line"), col = c("blue", "red"), pch = c(16, NA), lty = c(NA, 1))
```

In our data, we have $\lambda<\hat{\mu}$, QoS level $\mathbb{P}(x)=1-\frac{\lambda}{\hat{a}c+\hat{b}\lambda}e^{-(\hat{a}c+\hat{b}\lambda-\lambda)x}=1-\frac{\lambda}{0.03544c+1.43244\lambda}e^{-(0.03544c+1.43244\lambda-\lambda)x}$

```{r}
# prediction of prob of waittime <x for given cluster related information and time x
predict_prob_waittime <- function(season, PeriodOfWeek, PeriodOfDay,x){
  match_set <- Result %>% filter(Season == season,Period_of_Week == PeriodOfWeek,Time_of_Day == PeriodOfDay)
  my_lambda <-match_set$Arrival_Rate
  my_mu <-match_set$Service_Rate
  my_c <-match_set$Avg_Servers
  a_hat<-0.03544
  b_hat<-1.43244
  Pr<-1-my_lambda/(a_hat*my_c+b_hat*my_lambda)*exp(-(a_hat*my_c+b_hat*my_lambda-my_lambda)*x)
  return(round(Pr,5))
}

PlotCDF<-function(df, Time){
  df<-cbind(Time, df)%>%gather("Cluster", "Value",2:(length(df)-1))
  p<-ggplot(df, aes(x = Time, y = Value, color = Cluster)) +
      geom_line() +
      labs(title = paste("CDF of Cluster"), x = "Time in mins", y = "CDF")
  print(p)
  }
```

```{r}
checkpoint <-seq(5,30,5)

P<-apply(Result, 1, function(x){
  res<-sapply(checkpoint, function(val){predict_prob_waittime(season=x[1],PeriodOfWeek=x[2],PeriodOfDay=x[3],x=val)})
  return(res)
})%>%t()
dimnames(P)<-list(rownames(Result), paste0("Pr(<", checkpoint, " mins)") )
P%>%kable(booktabs = TRUE,caption = "Performance Level")%>%
  kable_styling(font_size=7, latex_options=c("striped","scale_down","hold_position"))%>%
  row_spec(0,bold=TRUE)%>%
  column_spec(1,bold=TRUE)
```

```{r}
checkpoint <-0.0000001*exp(seq(0.1,19.5,0.1))

P<-apply(Result, 1, function(x){
  res<-sapply(checkpoint, function(val){predict_prob_waittime(season=x[1],PeriodOfWeek=x[2],PeriodOfDay=x[3],x=val)})
  return(res)
})
dimnames(P)<-list(paste0("Pr(<", checkpoint, " mins)"), rownames(Result) )
P<-as.data.frame(P)

PlotCDF(P, Time = checkpoint)
```

### References



